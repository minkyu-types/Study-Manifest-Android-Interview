## âœ… Q14. ANRì´ë€ ë¬´ì—‡ì¸ì§€, ANRì´ ë°œìƒí•˜ëŠ” ì£¼ìš” ì›ì¸ì€ ë¬´ì—‡ì´ë©°, ì–´ë–»ê²Œ ì˜ˆë°©í•  ìˆ˜ ìˆëŠ”ì§€ ì„¤ëª…í•´ì£¼ì„¸ìš”.

---

### ğŸ“Œ ANR(Application Not Responding) ê°œìš”

ANRì€ ì•ˆë“œë¡œì´ë“œ ì‹œìŠ¤í…œì´ íŠ¹ì • ì‹œê°„ ì´ìƒ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì‚¬ìš©ì ì…ë ¥ì— ë°˜ì‘í•˜ì§€ ì•Šì„ ë•Œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ ë©”ì‹œì§€ì…ë‹ˆë‹¤. ì´ëŠ” ì‚¬ìš©ì ê²½í—˜ì„ í•´ì¹˜ê¸° ë•Œë¬¸ì— **ë°˜ë“œì‹œ ì‚¬ì „ì— ì˜ˆë°©**í•´ì•¼ í•©ë‹ˆë‹¤.

---

### âš ï¸ ANR ë°œìƒ ì¡°ê±´

| ìœ í˜• | ì¡°ê±´ | ì œí•œ ì‹œê°„ |
|------|------|------------|
| **Input Dispatching Timeout** | ë©”ì¸ ìŠ¤ë ˆë“œê°€ í„°ì¹˜, í‚¤ ì…ë ¥ ë“± ì‚¬ìš©ì ì…ë ¥ ì²˜ë¦¬ ì§€ì—° | **5ì´ˆ** ì´ˆê³¼ |
| **Broadcast Timeout** | ë¸Œë¡œë“œìºìŠ¤íŠ¸ ë¦¬ì‹œë²„ê°€ ì‹¤í–‰ ì™„ë£Œë˜ì§€ ì•ŠìŒ | **10ì´ˆ** ì´ˆê³¼ (í¬ê·¸ë¼ìš´ë“œ), 60ì´ˆ (ë°±ê·¸ë¼ìš´ë“œ) |
| **Service Timeout** | ì„œë¹„ìŠ¤ê°€ `onCreate()` ë˜ëŠ” `onStartCommand()` ë‚´ì—ì„œ ì§€ì—° | **20ì´ˆ** ì´ˆê³¼ (í¬ê·¸ë¼ìš´ë“œ), 200ì´ˆ (ë°±ê·¸ë¼ìš´ë“œ) |
| **ContentProvider Timeout** | ë‹¤ë¥¸ ì•±ì´ ì œê³µí•œ ContentProvider í˜¸ì¶œì´ ì§€ì—° | **5ì´ˆ** ì´ˆê³¼ |

---

### ğŸ§¨ ì£¼ìš” ì›ì¸

- **ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ê¸´ ì‘ì—… ìˆ˜í–‰**
  - ë„¤íŠ¸ì›Œí¬ ìš”ì²­, DB ì‘ì—…, íŒŒì¼ I/O ë“±ì„ UI ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰í•  ë•Œ
- **ë¬´í•œ ë£¨í”„ ë˜ëŠ” ë™ê¸°í™” ë¬¸ì œ**
  - ì˜ëª»ëœ `while` ë£¨í”„, `synchronized` ë¸”ë¡œí‚¹ ë“±
- **ê³¼ë„í•œ ë¸Œë¡œë“œìºìŠ¤íŠ¸ ì²˜ë¦¬ ì‹œê°„**
  - `onReceive()` ë‚´ì—ì„œ ë¹„ë™ê¸° ì‘ì—… ì—†ì´ ì˜¤ë˜ ì²˜ë¦¬í•  ê²½ìš°
- **ContentProvider í˜¸ì¶œì—ì„œ ì‘ë‹µ ì§€ì—°**
  - ì¿¼ë¦¬/ì‚½ì… ì‹œ ëŒ€ê¸° ìƒíƒœê°€ ê¸¸ì–´ì§ˆ ê²½ìš°

---

### âœ… ì˜ˆë°© ë°©ë²•
---

### 1ï¸âƒ£ ë¬´ê±°ìš´ ì‘ì—…ì€ ë©”ì¸ ìŠ¤ë ˆë“œ ë°–ì—ì„œ ì‹¤í–‰

> íŒŒì¼ I/O, ë„¤íŠ¸ì›Œí¬, DB ì¿¼ë¦¬ëŠ” ë°˜ë“œì‹œ ë°±ê·¸ë¼ìš´ë“œ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰

```kotlin
lifecycleScope.launch(Dispatchers.IO) {
    val fileData = File(context.filesDir, "sample.txt").readText()
    withContext(Dispatchers.Main) {
        textView.text = fileData
    }
}
```

---

### 2ï¸âƒ£ WorkManager ì‚¬ìš© (ì¥ê¸° ë°±ê·¸ë¼ìš´ë“œ ì‘ì—…)

> ë°ì´í„° ë™ê¸°í™”, ë¡œê·¸ ì—…ë¡œë“œ ë“± ë°±ê·¸ë¼ìš´ë“œì—ì„œ ì•ˆì •ì ìœ¼ë¡œ ì‹¤í–‰

```kotlin
class SyncWorker(context: Context, params: WorkerParameters) : Worker(context, params) {
    override fun doWork(): Result {
        // ì¥ê¸° ì‘ì—… ìˆ˜í–‰
        syncDataFromServer()
        return Result.success()
    }
}

val request = PeriodicWorkRequestBuilder<SyncWorker>(1, TimeUnit.HOURS).build()

WorkManager.getInstance(context).enqueueUniquePeriodicWork(
    "SyncJob",
    ExistingPeriodicWorkPolicy.KEEP,
    request
)
```

---

### 3ï¸âƒ£ Paging ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ëŒ€ëŸ‰ ë°ì´í„° ì²˜ë¦¬ ìµœì í™”

> í˜ì´ì§•ì„ í†µí•´ RecyclerView ì„±ëŠ¥ ìœ ì§€ ë° ë©”ëª¨ë¦¬ ì ˆì•½

```kotlin
class MyPagingSource : PagingSource<Int, Item>() {
    override suspend fun load(params: LoadParams<Int>): LoadResult<Int, Item> {
        val page = params.key ?: 1
        val response = api.fetchItems(page)
        return LoadResult.Page(
            data = response.items,
            prevKey = if (page == 1) null else page - 1,
            nextKey = if (response.items.isEmpty()) null else page + 1
        )
    }
}
```

---

### 4ï¸âƒ£ ViewModelë¡œ êµ¬ì„± ë³€ê²½ ëŒ€ì‘

> í™”ë©´ íšŒì „ ì‹œ ë°ì´í„° ë³´ì¡´ ë° ë¶ˆí•„ìš”í•œ UI ì¬ìƒì„± ë°©ì§€

```kotlin
class MainViewModel : ViewModel() {
    val userName = MutableLiveData<String>()
}

// Fragment ë˜ëŠ” Activityì—ì„œ observe
viewModel.userName.observe(viewLifecycleOwner) { name ->
    textView.text = name
}
```

---

### 5ï¸âƒ£ Android Studio Profilerë¡œ ì„±ëŠ¥ ëª¨ë‹ˆí„°ë§

> CPU, Memory, Network ì‚¬ìš©ëŸ‰ ì¶”ì  â†’ ANR ì›ì¸ ì‚¬ì „ íŒŒì•…  
> `View > Tool Windows > Profiler` ì—ì„œ í™•ì¸ ê°€ëŠ¥  
> íŠ¹íˆ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ **CPU spikeê°€ 5ì´ˆ ì´ìƒ** ì§€ì†ë˜ë©´ ANR ìœ„í—˜

---

### 6ï¸âƒ£ ë¸”ë¡œí‚¹(blocking) í˜¸ì¶œ í”¼í•˜ê¸°

> Thread.sleep(), ë¬´í•œ ë£¨í”„ ë“±ì€ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‚¬ìš© ê¸ˆì§€

ğŸš« ì˜ëª»ëœ ì˜ˆì‹œ (ANR ë°œìƒ ìœ„í—˜)

```kotlin
// ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì‹¤í–‰ ì‹œ ANR ìœ ë°œ
Thread.sleep(3000)
```

âœ… ì˜¬ë°”ë¥¸ ëŒ€ì•ˆ

```kotlin
Handler(Looper.getMainLooper()).postDelayed({
    // 3ì´ˆ í›„ ì‹¤í–‰
    textView.text = "3ì´ˆ í›„ ì‹¤í–‰ë¨"
}, 3000)
```

---

### 7ï¸âƒ£ Handlerë¥¼ ì‚¬ìš©í•œ ê°€ë²¼ìš´ ì§€ì—° ì‘ì—… ì²˜ë¦¬

> `sleep()` ëŒ€ì‹  `postDelayed()`ë¡œ ë©”ì¸ ìŠ¤ë ˆë“œ ì°¨ë‹¨ ì—†ì´ ì²˜ë¦¬

```kotlin
button.setOnClickListener {
    Handler(Looper.getMainLooper()).postDelayed({
        Toast.makeText(context, "1ì´ˆ í›„ ì‹¤í–‰ë¨", Toast.LENGTH_SHORT).show()
    }, 1000)
}
```

---

### ğŸ’¬ ì‹¤ì „ ì§ˆë¬¸
#### Q) ANRì„ ì§„ë‹¨í•˜ê³  ì•± ì„±ëŠ¥ê³¼ ìœ ì € ê²½í—˜ì„ ê°œì„ í•´ë³´ì‹  ê²½í—˜ì´ ìˆìœ¼ì‹ ê°€ìš”?

> Kiosk ì•±ì„ ê°œë°œí• ë•Œ, ì „ì²´ jsonìœ¼ë¡œ êµ¬ì„±ëœ ë°ì´í„°ë¥¼ ëª¨ë‘ ë¡œë“œí•œ ìƒíƒœì—ì„œ ì§„í–‰í•˜ë„ë¡ ë°±ì•¤ë“œê°€ êµ¬ì„±ë˜ì–´ ìˆì—ˆê³ , ê·¸ ë•Œ í˜ì´ì§•, diffUtil, ViewPager2 ë“±ì˜ ìµœì‹  ì»´í¬ë„ŒíŠ¸ë¥¼ í™œìš©í•˜ê³ , ì „ì²´ json ì„ Room ìœ¼ë¡œ ë§¤í•‘í•˜ì—¬ ì¿¼ë¦¬ ìµœì í™”ë¥¼ í†µí•´ ANRì„ í•´ì†Œí•œì ì´ ìˆìŠµë‹ˆë‹¤.

---
