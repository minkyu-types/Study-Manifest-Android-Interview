## ❓ Q) 47. Window란 무엇인가요

### 📌 정의
- **Window**는 안드로이드 애플리케이션에서 **UI를 표현하는 최상위 컨테이너**입니다.  
- 모든 **Activity**는 실행 시 하나의 Window를 생성하며, 이 Window는 **화면 표시와 사용자 입력 처리**를 담당합니다.  
- 기본 구현체는 `PhoneWindow`입니다.

---

### 🏗️ Window의 주요 구성 요소
1. **DecorView**  
   - Window의 최상위 뷰.  
   - 상태바(Status Bar), 내비게이션 바(Navigation Bar), 액션바(Action Bar)와 같은 시스템 UI와  
     `setContentView()`를 통해 지정한 앱의 콘텐츠 뷰를 포함합니다.  

2. **WindowManager**  
   - Window를 실제 화면에 배치하고 속성을 관리하는 역할을 담당합니다.  
   - 다이얼로그(Dialog), 팝업(PopupWindow), 토스트(Toast) 모두 Window를 기반으로 동작합니다.  

3. **Activity와의 관계**  
   - Activity는 Window를 직접 생성하지 않고 시스템에 의해 제공받습니다.  
   - 개발자는 `getWindow()`를 통해 속성을 제어할 수 있습니다.  

---

### ⚙️ 동작 방식
- **레이아웃 배치**: XML 레이아웃은 Window 내부의 `DecorView`에 추가됩니다.  
- **속성 제어**: 플래그(전체 화면, 밝기 등)는 Window 단위에서 제어됩니다.  
- **이벤트 처리**: Window는 입력 이벤트(터치·키 입력)를 수신 후 내부 뷰로 전달합니다.  

---

### 🛠️ 코드 예시
#### Activity의 Window 제어
```kotlin
// Activity에서 현재 Window 참조
val window: Window = this.window

// 전체 화면 모드 설정
window.setFlags(
    WindowManager.LayoutParams.FLAG_FULLSCREEN,
    WindowManager.LayoutParams.FLAG_FULLSCREEN
)
```

---

### 💬 실전 질문
**Q)단순한 레이아웃을 가진 Activity가 화면에 표시될 때 몇 개의 Window가 존재하며, 어느 부분에 필요한가요**

**A)**
- 일반적으로 Activity는 하나의 Window만 가집니다.  
- 하지만 **Dialog, PopupWindow** 같은 UI 요소를 추가하면 내부적으로 별도의 Window가 생성됩니다.  
- 예: 시스템 오버레이(채팅 헤드, 알림창)는 WindowManager를 통해 별도 Window로 화면에 추가됩니다.
---

### 💡 Pro Tips for Mastery

#### 📍 커스텀 오버레이 구현
- WindowManager를 사용하면 오버레이 뷰(예: 채팅 버블)를 직접 띄울 수 있습니다.  

```kotlin
val windowManager = getSystemService(Context.WINDOW_SERVICE) as WindowManager

val textView = TextView(this).apply {
    text = "Hello, WindowManager!"
    textSize = 24f
    setBackgroundColor(Color.YELLOW)
}

val params = WindowManager.LayoutParams(
    WindowManager.LayoutParams.WRAP_CONTENT,
    WindowManager.LayoutParams.WRAP_CONTENT,
    WindowManager.LayoutParams.TYPE_APPLICATION_OVERLAY,
    WindowManager.LayoutParams.FLAG_NOT_FOCUSABLE,
    PixelFormat.TRANSLUCENT
)

windowManager.addView(textView, params)
```

- Android 6.0 이상에서는 `SYSTEM_ALERT_WINDOW` 권한이 필요합니다.  

#### 📍 보안 고려사항
- 잘못된 Window 오버레이 사용은 피싱·보안 문제를 일으킬 수 있습니다.  

#### 📍 테마 및 스타일 제어
- `windowNoTitle`, `windowFullscreen` 같은 속성을 테마에서 지정 가능.  

#### 📍 Jetpack Compose 연계
- Compose의 `setContent {}` 역시 내부적으로 Window의 DecorView에 UI를 추가합니다.  
