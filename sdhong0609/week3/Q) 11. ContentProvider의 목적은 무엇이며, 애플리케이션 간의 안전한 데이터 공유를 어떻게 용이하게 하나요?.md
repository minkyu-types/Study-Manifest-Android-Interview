## Q) 11. [ContentProvider](https://developer.android.com/guide/topics/providers/content-provider-basics)ì˜ ëª©ì ì€ ë¬´ì—‡ì´ë©°, ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ì˜ ì•ˆì „í•œ ë°ì´í„° ê³µìœ ë¥¼ ì–´ë–»ê²Œ ìš©ì´í•˜ê²Œ í•˜ë‚˜ìš”?
- ContentProviderëŠ” êµ¬ì¡°í™”ëœ ë°ì´í„°ì— ëŒ€í•œ ì ‘ê·¼ì„ ê´€ë¦¬í•˜ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ ë°ì´í„° ê³µìœ ë¥¼ ìœ„í•œ í‘œì¤€í™”ëœ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•˜ëŠ” ì»´í¬ë„ŒíŠ¸
- ë‹¤ë¥¸ ì•±ì´ë‚˜ ì»´í¬ë„ŒíŠ¸ê°€ ë°ì´í„°ë¥¼ ì¿¼ë¦¬, ì‚½ì…, ì—…ë°ì´íŠ¸ ë˜ëŠ” ì‚­ì œí•˜ëŠ” ë° ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¤‘ì•™ ì €ì¥ì†Œ ì—­í• 
- ì•± ê°„ì˜ ì•ˆì „í•˜ê³  ì¼ê´€ëœ ë°ì´í„° ê³µìœ ë¥¼ ë³´ì¥
- ì—¬ëŸ¬ ì•±ì´ ë™ì¼í•œ ë°ì´í„°ì— ì ‘ê·¼í•´ì•¼ í•˜ê±°ë‚˜, ë°ì´í„°ë² ì´ìŠ¤ ë˜ëŠ” ë‚´ë¶€ ì €ì¥ì†Œêµ¬ì¡°ë¥¼ ë…¸ì¶œí•˜ì§€ ì•Šê³  ë‹¤ë¥¸ ì•±ì— ë°ì´í„°ë¥¼ ì œê³µí•˜ë ¤ëŠ” ê²½ìš° íŠ¹íˆ ìœ ìš©í•˜ë‹¤.

### ContentProviderì˜ ëª©ì 
- ì£¼ìš” ëª©ì  : ë°ì´í„° ì ‘ê·¼ ë¡œì§ì„ ìº¡ìŠí™”í•˜ì—¬ ì•± ê°„ ë°ì´í„° ê³µìœ ë¥¼ ë” ì‰½ê³  ì•ˆì „í•˜ê²Œ ë§Œë“œëŠ” ê²ƒ
- SQLite ë°ì´í„°ë² ì´ìŠ¤, íŒŒì¼ ì‹œìŠ¤í…œ ë˜ëŠ” ë„¤íŠ¸ì›Œí¬ ê¸°ë°˜ ë°ì´í„°ì¼ ìˆ˜ ìˆëŠ” ê¸°ë³¸ ë°ì´í„° ì†ŒìŠ¤ë¥¼ ì¶”ìƒí™”í•˜ê³  ë°ì´í„°ì™€ ìƒí˜¸ ì‘ìš©í•˜ê¸° ìœ„í•œ í†µí•© ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µ

### ContentProviderì˜ ì£¼ìš” êµ¬ì„± ìš”ì†Œ
ConterProviderëŠ” ë°ì´í„° ì ‘ê·¼ ì£¼ì†Œë¡œ URI (Uniform Resource Identifier)ë¥¼ ì‚¬ìš©í•œë‹¤. URIëŠ” ë‹¤ìŒìœ¼ë¡œ êµ¬ì„±ëœë‹¤.
- ê¶Œí•œ(Authority) : ContentProviderë¥¼ ì‹ë³„ (ì˜ˆ: com.example.myapp.provider)
- Path : ë°ì´í„° ìœ í˜•ì„ ì§€ì • (ì˜ˆ: /users, /products)
- ID (optional) : ë°ì´í„° ì…‹ ë‚´ì˜ íŠ¹ì • í•­ëª©ì„ ì°¸ì¡°

### ContentProvider êµ¬í˜„í•˜ê¸°
ContentProviderë¥¼ ìƒì†ë°›ê³  ë‹¤ìŒ ë©”ì„œë“œë¥¼ êµ¬í˜„í•´ì•¼ í•œë‹¤.
- onCreate() : ContentProvider ì´ˆê¸°í™”
- query() : ë°ì´í„°ë¥¼ ê²€ìƒ‰
- insert() : ìƒˆ ë°ì´í„° ì¶”ê°€
- update() : ê¸°ì¡´ ë°ì´í„°ë¥¼ ìˆ˜ì •
- delete() : ë°ì´í„°ë¥¼ ì œê±°
- getType() : ë°ì´í„°ì˜ MIME ìœ í˜•ì„ ë°˜í™˜
    - MIME(Multipurpose Internet Mail Extensions) ìœ í˜•ì´ë€? : ì–´ë–¤ íŒŒì¼ì´ë‚˜ ë°ì´í„°ê°€ ì–´ë–¤ ì¢…ë¥˜ì¸ì§€ í‘œí˜„í•˜ëŠ” í‘œì¤€ í¬ë§·. Mailì´ë¼ëŠ” ë‹¨ì–´ê°€ í¬í•¨ë˜ì–´ ìˆì§€ë§Œ ì‹¤ì œë¡œëŠ” ë©”ì¼ë¿ ì•„ë‹ˆë¼ ì›¹ ë¸Œë¼ìš°ì €, Android ë“± ë‹¤ì–‘í•œ ê³³ì—ì„œ ë°ì´í„° íƒ€ì…ì„ ì‹ë³„í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.<br>(ì˜ˆ : text/plainëŠ” ì¼ë°˜ í…ìŠ¤íŠ¸, image/pngëŠ” PNG ì´ë¯¸ì§€ íŒŒì¼, application/jsonì€ JSON ë°ì´í„°)
    
```kotlin
class MyContentProvider : ContentProvider() {

    private lateinit var database: SQLiteDatabase

    override fun onCreate(): Boolean {
        database = MyDatabaseHelper(context!!).writableDatabase
        return true
    }

    override fun query(
        uri: Uri,
        projection: Array<String>?,
        selection: String?,
        selectionArgs: Array<String>?,
        sortOrder: String?
    ): Cursor? {
        // URI íŒŒì‹± ë° í…Œì´ë¸”/ì¡°ê±´ ê²°ì • í•„ìš”
        return database.query("users", projection, selection, selectionArgs, null, null, sortOrder)
    }

    override fun insert(uri: Uri, values: ContentValues?): Uri? {
        val id = database.insert("users", null, values)
        // context?.contentResolver?.notifyChange(uri, null) // ë°ì´í„° ë³€ê²½ ì•Œë¦¼ (í•„ìš”ì‹œ)
        return ContentUris.withAppendedId(uri, id)
    }

    override fun update(uri: Uri, values: ContentValues?, selection: String?, selectionArgs: Array<String>?): Int {
        val count = database.update("users", values, selection, selectionArgs)
        // if (count > 0) context?.contentResolver?.notifyChange(uri, null) // ë°ì´í„° ë³€ê²½ ì•Œë¦¼ (í•„ìš”ì‹œ)
        return count
    }

    override fun delete(uri: Uri, selection: String?, selectionArgs: Array<String>?): Int {
        val count = database.delete("users", selection, selectionArgs)
        // if (count > 0) context?.contentResolver?.notifyChange(uri, null) // ë°ì´í„° ë³€ê²½ ì•Œë¦¼ (í•„ìš”ì‹œ)
        return count
    }

    override fun getType(uri: Uri): String? {
        // URIì— ë”°ë¥¸ MIME íƒ€ì… ë°˜í™˜ ë¡œì§ í•„ìš”
        return "vnd.android.cursor.dir/vnd.com.example.myapp.users" // ì˜ˆì‹œ
    }
}
```

### ContentProvider ë“±ë¡í•˜ê¸°
ë‹¤ë¥¸ ì•±ì—ì„œ ContentProviderì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í•˜ë ¤ë©´ AndroidManifest.xml íŒŒì¼ì— ì„ ì–¸í•´ì•¼ í•œë‹¤. authority ì†ì„±ì€ ContentProviderë¥¼ ê³ ìœ í•˜ê²Œ ì‹ë³„í•œë‹¤.
```xml
<!-- AndroidManifest.xml -->
<provider
    android:name=".MyContentProvider"
    android:authorities="com.example.myapp.provider"
    android:exported="true"
    android:grantUriPermissions="true" />
```

### ContentProviderì—ì„œ ë°ì´í„° ì ‘ê·¼í•˜ê¸°
ë‹¤ë¥¸ ì•±ì—ì„œ ContentProviderì™€ ìƒí˜¸ ì‘ìš©í•˜ë ¤ë©´ ContentResolver í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤. ContentResolverëŠ” ë°ì´í„°ë¥¼ ì¿¼ë¦¬, ì‚½ì…, ì—…ë°ì´íŠ¸ ë˜ëŠ” ì‚­ì œí•˜ëŠ” ë©”ì„œë“œë¥¼ ì œê³µí•œë‹¤.
```kotlin
val contentResolver = context.contentResolver

// ë°ì´í„° ì¿¼ë¦¬
val cursor = contentResolver.query(
    Uri.parse("content://com.example.myapp.provider/users"),
    null,
    null,
    null,
    null
)

// ë°ì´í„° ì‚½ì…
val values = ContentValues().apply {
    put("name", "John Doe")
    put("email", "johndoe@example.com")
}
contentResolver.insert(Uri.parse("content://com.example.myapp.provider/users"), values)
```

### ContentProvider ì‚¬ìš© ì‚¬ë¡€
- ë‹¤ë¥¸ ì• í”Œë¦¬ì¼€ì´ì…˜ ê°„ ë°ì´í„° ê³µìœ 
- ì•± ì‹œì‘ ì‹œ ì»´í¬ë„ŒíŠ¸ ë˜ëŠ” ë¦¬ì†ŒìŠ¤ ì´ˆê¸°í™”
- ì—°ë½ì²˜, ë¯¸ë””ì–´ íŒŒì¼ ë˜ëŠ” ì•±ë³„ ë°ì´í„°ì™€ ê°™ì€ êµ¬ì¡°í™”ëœ ë°ì´í„°ì— ëŒ€í•œ ì ‘ê·¼ ì œê³µ
- ì—°ë½ì²˜ ì•±ì´ë‚˜ íŒŒì¼ ì„ íƒê¸°ì™€ ê°™ì€ ì•ˆë“œë¡œì´ë“œ ì‹œìŠ¤í…œ ê¸°ëŠ¥ê³¼ì˜ í†µí•© í™œì„±í™”
- ì„¸ë¶„í™”ëœ ë³´ì•ˆ ì œì–´ë¥¼ í†µí•œ ë°ì´í„° ì ‘ê·¼ í—ˆìš©

### ì‹¤ì „ ì§ˆë¬¸
Q) ContentProvider URIì˜ ì£¼ìš” êµ¬ì„± ìš”ì†ŒëŠ” ë¬´ì—‡ì´ë©°, ContentResolverëŠ” ë°ì´í„°ë¥¼ ì¿¼ë¦¬í•˜ê±°ë‚˜ ìˆ˜ì •í•˜ê¸° ìœ„í•´ ContentProviderì™€ ì–´ë–»ê²Œ ìƒí˜¸ ì‘ìš©í•˜ë‚˜ìš”?<br>
A) ContentProvider URIì˜ ì£¼ìš” êµ¬ì„± ìš”ì†ŒëŠ” ContentProviderë¥¼ ì‹ë³„í•˜ëŠ” ê¶Œí•œ(Authority), ë°ì´í„° ìœ í˜•ì„ ì§€ì •í•˜ëŠ” Path, ë°ì´í„° ì…‹ ë‚´ì˜ íŠ¹ì • í•­ëª©ì„ ì°¸ì¡°í•˜ëŠ” IDë¡œ êµ¬ì„±ë©ë‹ˆë‹¤. ContentResolverëŠ” CRUD ë©”ì„œë“œë¥¼ ì œê³µí•˜ëŠ”ë°, ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ URIë¥¼ ê¸°ë°˜ìœ¼ë¡œ ContentProviderì˜ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë°ì´í„°ë¥¼ ì¿¼ë¦¬, ì‚½ì…, ì—…ë°ì´íŠ¸, ì‚­ì œí•©ë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´, ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.
```kotlin
contentResolver.query(uri, ...) â†’ ContentProviderì˜ query() í˜¸ì¶œ
contentResolver.insert(uri, values) â†’ ContentProviderì˜ insert() í˜¸ì¶œ
contentResolver.update(uri, values, ...) â†’ ContentProviderì˜ update() í˜¸ì¶œ
contentResolver.delete(uri, ...) â†’ ContentProviderì˜ delete() í˜¸ì¶œ
```

### ğŸ’¡ Pro Tips for Mastery: ì•± ì‹œì‘ ì‹œ ë¦¬ì†ŒìŠ¤ë‚˜ ì´ˆê¸° ì…‹ì—…ì„ ìœ„í•´ ContentProviderë¥¼ ì‚¬ìš©í•˜ëŠ” ì‚¬ìš© ì‚¬ë¡€
- ì¼ë°˜ì ìœ¼ë¡œ ë¦¬ì†ŒìŠ¤ë‚˜ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ˆê¸°í™”ëŠ” Application í´ë˜ìŠ¤ì—ì„œ í•˜ì§€ë§Œ, ê´€ì‹¬ì‚¬ë¥¼ ë” ì˜ ë¶„ë¦¬í•˜ê¸° ìœ„í•´ ì´ˆê¸°í™” ê´€ë ¨ ë¡œì§ì„ ë³„ë„ì˜ ContentProviderì— ìº¡ìŠí™”í•  ìˆ˜ ìˆë‹¤. (ë°©ë²• : ì»¤ìŠ¤í…€ ContentProvider ìƒì„± í›„ ë§¤ë‹ˆí˜ìŠ¤íŠ¸ì— ë“±ë¡)
- ContentProviderì˜ onCreate() ë©”ì„œë“œëŠ” Application.onCreate() ë©”ì„œë“œë³´ë‹¤ ë¨¼ì € í˜¸ì¶œë˜ë¯€ë¡œ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ í›Œë¥­í•œ ì§„ì…ì  ì—­í• ì„ í•œë‹¤.
- ê°€ë ¹ [Firebase Android SDK](https://github.com/firebase/firebase-android-sdk/blob/6a03d4ca8ab6ae86968cded8e04e8802d5393882/firebase-common/src/main/java/com/google/firebase/provider/FirebaseInitProvider.java#L34)ëŠ” ì»¤ìŠ¤í…€ ContentProviderë¥¼ ì‚¬ìš©í•˜ì—¬ Firebase SDKì˜ ì˜ì¡´ì„±ì„ ì¶”ê°€í•˜ëŠ” ê²ƒë§Œìœ¼ë¡œë„ ìë™ìœ¼ë¡œ ì´ˆê¸°í™”í•œë‹¤.
- ì´ëŸ¬í•œ ë°©ì‹ì€ Application í´ë˜ìŠ¤ì—ì„œ ê°œë°œìê°€ `FirebaseApp.initializeApp(this)`ë¥¼ í˜¸ì¶œí•  ìˆ˜ê³ ë¥¼ ëœì–´ì¤€ë‹¤.

```java
// FirebaseInitProvider ì‹¤ì œ ì½”ë“œ
public class FirebaseInitProvider extends ContentProvider {
  /** Called before {@link Application#onCreate()}. */
  @Override
  public boolean onCreate() {
    try {
      currentlyInitializing.set(true);
      if (FirebaseApp.initializeApp(getContext()) == null) {
        Log.i(TAG, "FirebaseApp initialization unsuccessful");
      } else {
        Log.i(TAG, "FirebaseApp initialization successful");
      }
      return false; // ì´ˆê¸°í™” ì„±ê³µ ì—¬ë¶€ì™€ ê´€ê³„ì—†ì´ false ë°˜í™˜ (Providerë¥¼ ìœ ì§€í•  í•„ìš”ê°€ ì—†ê¸° ë•Œë¬¸ì—)
    } finally {
      currentlyInitializing.set(false);
    }
  }
  // ë‹¤ë¥¸ ContentProvider ë©”ì„œë“œë“¤ì€ null ë˜ëŠ” ì˜ˆì™¸ë¥¼ ë°˜í™˜/ë˜ì§‘ë‹ˆë‹¤.
}
```
```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools">
    <!--Although the *SdkVersion is captured in gradle build files, this is required for non gradle builds-->
    <!--<uses-sdk android:minSdkVersion="21"/>-->
    <application>

        <provider
            android:name="com.google.firebase.provider.FirebaseInitProvider"
            android:authorities="${applicationId}.firebaseinitprovider"
            android:directBootAware="true"
            android:exported="false"
            android:initOrder="100" /> <!-- initOrderë¡œ ì´ˆê¸°í™” ìˆœì„œ ì œì–´ -->

    </application>
</manifest>
```

---

ContentProviderì˜ ë˜ë‹¤ë¥¸ ì‚¬ìš© ì‚¬ë¡€ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œ ì»´í¬ë„ŒíŠ¸ë¥¼ ê°„ë‹¨í•˜ê³  íš¨ìœ¨ì ìœ¼ë¡œ ì´ˆê¸°í™”í•  ìˆ˜ ìˆëŠ” Jetpack [App Startup ë¼ì´ë¸ŒëŸ¬ë¦¬](https://developer.android.com/topic/libraries/app-startup)ì´ë‹¤.
```java
// InitializationProvider ì‹¤ì œ ë‚´ë¶€ êµ¬í˜„
/**
 * The {@link ContentProvider} which discovers {@link Initializer}s in an application and
 * initializes them before {@link Application#onCreate()}.
 */
public class InitializationProvider extends ContentProvider {

    @Override
    public final boolean onCreate() {
        Context context = getContext();
        if (context != null) {
            Context applicationContext = context.getApplicationContext();
            if (applicationContext != null) {
                // Initialize all registered Initializer classes.
                AppInitializer.getInstance(context).discoverAndInitialize(getClass());
            } else {
                StartupLogger.w("Deferring initialization because `applicationContext` is null.");
            }
        } else {
            throw new StartupException("Context cannot be null");
        }
        return true; // Provider ìƒì„± ì„±ê³µ í‘œì‹œ
    }
    // ë‹¤ë¥¸ ContentProvider ë©”ì„œë“œë“¤ì€ null ë˜ëŠ” ì˜ˆì™¸ë¥¼ ë°˜í™˜/ë˜ì§‘ë‹ˆë‹¤.
}
```
onCreate()ì—ì„œ `AppInitializer.getInstance(context).discoverAndInitialize`ë¥¼ í˜¸ì¶œí•˜ì—¬, Application ìƒëª…ì£¼ê¸°ê°€ ì‹œì‘ë˜ê¸° ì „ì— ë“±ë¡ëœ ëª¨ë“  Initializer êµ¬í˜„ì„ ìë™ìœ¼ë¡œ ê²€ìƒ‰í•˜ê³  ì´ˆê¸°í™”í•œë‹¤. ì´ë¥¼ í†µí•´ `Application.onCreate()` ë©”ì„œë“œë¥¼ ë‚œì¡í•˜ê²Œ ë§Œë“¤ì§€ ì•Šê³  ì•± ì»´í¬ë„ŒíŠ¸ë¥¼ ëª¨ë“ˆì‹ìœ¼ë¡œ ë¶„ë¦¬í•˜ì—¬ ê¹”ë”í•˜ê³  íš¨ìœ¨ì ì¸ ì´ˆê¸°í™”ê°€ ê°€ëŠ¥í•˜ë‹¤.
